// @ts-ignore
import htmlparser from 'htmlparser2-without-node-native'

import Node from './node'

export const htmlToElement = (rawHtml: string, done: (err: any, element?: any | null) => any): void => {
  const handler = new htmlparser.DomHandler((err: any, dom: any) => {
    if (err) done(err)
    done(null, domToNode(dom))
  })
  const parser = new htmlparser.Parser(handler)
  parser.write(rawHtml)
  parser.done()
}

const domToNode = (dom: any | null, parent: Node | null = null): any => {
  if (!dom) return null
  return dom.map((node: any) => {
    const nodeName = node.name || 'TextNode'
    const htmlClasses: string[] = node.attribs?.class?.split(' ') || []
    const htmlIds: string[] = node.attribs?.id?.split(' ') || []
    const selectors: string[] = [nodeName]

    htmlClasses.forEach((htmlClass) => {
      selectors.unshift(`.${htmlClass}`)
      selectors.unshift(`${nodeName}.${htmlClass}`)
    })
    let tempSelectors = [...selectors]
    htmlIds.forEach((htmlId) => {
      selectors.unshift(`#${htmlId}`)
      tempSelectors.forEach((selector) => {
        selectors.unshift(`${selector}#${htmlId}`)
      })
    })
    tempSelectors = [...selectors]
    parent?.path.forEach((parentPath) => {
      tempSelectors.forEach((path) => {
        selectors.push(`${parentPath}>${path}`)
      })
    })

    const nativeNode = new Node({ name: node.name, data: node.data }, selectors, parent, node.attribs)
    nativeNode.children = domToNode(node.children, nativeNode)

    return nativeNode
  })
}

htmlToElement(
  '<h2 class="privacy-title">ПОЛИТИКА КОНФИДЕНЦИАЛЬНОСТИ ООО «БАСФОР»</h2><div class="row template--privacy-row"><div class="col-md-4 col-lg-4 col-sm-12 col-xs-12"><div><a href="#collecting_personal_information">Сбор и использование личной информации</a></div><div><a href="#automatically_collected_information">Информация собираемая автоматически</a></div><div><a href="#data_collection_goals ">Цели сбора персональных данных</a></div><div><a href="#child_personal_data_agreement">Согласие на обработку персональных данных ребенка</a></div></div><div class="col-md-4 col-lg-4 col-sm-12 col-xs-12"><div><a href="#methods_and_terms_of_personal_data_processing">Способы и сроки обработки персональных данных</a></div><div><a href="#user_rights">Права пользователя</a></div><div><a href="#cookie_files">Файлы cookies</a></div><div><a href="#external_sites_links">Ссылки на другие сайты</a></div><div><a href="#third_party_information_disclosure_cases">Случаи раскрытия информации третьим лицам</a></div></div><div class="col-md-4 col-lg-4 col-sm-12 col-xs-12"><div><a href="#personal_data_protection">Защита персональных данных</a></div><div><a href="#user_requests_and_complaints">Запросы и жалобы пользователя</a></div><div><a href="#update_of_privacy_policy">Изменение политики конфиденциальности</a></div></div></div><p>Настоящая Политика конфиденциальности действует в отношении всей информации, которую Общество с ограниченной ответственностью «БАСФОР» (ОГРН 1117746469433, адрес местонахождения/почтовый адрес: 117638, г.Москва, ул.Одесская, д.2, корп.А, этаж 9, телефон <a href="tel:71234567899">+7 (123) 456-78-99</a>, <a href="tel:79876543211">+7 (987) 654-32-11</a>) (далее — «БАСФОР») может получить о Пользователе во время использования им сайта <a href="/">www.busfor.ru</a> (далее — «Сайт») и устанавливает обязательства БАСФОР по неразглашению и обеспечению режима защиты конфиденциальности персональных данных, которые Пользователь предоставляет при регистрации или при оформлении электронного билета на сайте busfor.ru.</p><p>Использование сайта busfor.ru Пользователем (активация «v» напротив ссылки на Политику конфиденциальности и Пользовательское соглашение (оферту) на стадии оформления электронных билетов), означает согласие со всеми условиями настоящей Политики конфиденциальности (далее – Политики) и условиями обработки персональных данных. В случае несогласия с условиями Политики Пользователю будет доступен ограниченный функционал сайта busfor.ru.</p><h4 id="collecting_personal_information">СБОР И ИСПОЛЬЗОВАНИЕ ЛИЧНОЙ ИНФОРМАЦИИ</h4><p>В рамках настоящей Политики под «Персональными данными Пользователя» понимается любая персональная информация, по которой можно идентифицировать Пользователя. Пользователь самостоятельно предоставляет данные о себе либо о третьих лицах, представителями которых является на законных основаниях, по их поручению при регистрации на Сайте и/или в процессе оформления бронирования, покупки электронных билетов и/или прочих услуг на Сайте, включая, но не ограничиваясь, следующей информацией:<ul><li>фамилия, имя, отчество, дата рождения, пол, гражданство, серия и номер паспорта (свидетельства о рождении), мобильный телефон, адрес электронной почты и т.д.</li></ul></p><p>При этом БАСФОР вправе, но не обязано осуществлять проверку достоверности персональной информации, предоставляемой Пользователями и не осуществляет контроль за их дееспособностью. За предоставление недостоверной информации Пользователь несёт ответственность самостоятельно.</p><p><span class="bold underline">О платежных реквизитах:</span> Мы не получаем и не храним платежные реквизиты Пользователей – это компетенция соответствующих платформ и операторов по приему платежей (PayTure, PayPal, интернет-эквайринг и др.). Если Пользователь оплачивает оформленный электронный билет, то оператор платежей оповещает БАСФОР о проведенной транзакции, а мы со своей стороны следим, чтобы Пользователь получил на электронную почту электронный бланк билета и электронный чек. БАСФОР не получает никаких платежных реквизитов, а только хранит информацию о времени транзакции, валюте платежа, сумме и оплаченной услуге.</p><h4 id="automatically_collected_information">ИНФОРМАЦИЯ СОБИРАЕМАЯ АВТОМАТИЧЕСКИ</h4><p>Кроме личной информации (персональных данных), БАСФОР осуществляет сбор данных, которые не относятся непосредственно к конкретному человеку. БАСФОР может собирать, использовать, передавать и раскрывать эти сведения с любой целью.</p><p>Неличной информацией являются данные, которые автоматически передаются Сайту в процессе его использования с помощью установленного на устройстве пользователя программного обеспечения, в том числе IP-адрес, ID-номер, информация из cookies, информация о браузере пользователя (или иной программы, с помощью которой осуществляется доступ к Сайту), время доступа и иная информация о Пользователе и третьих лицах, сбор и/или предоставление которой определено в документах, регламентирующих порядок оказания услуг с помощью Сайта.</p><p>Дополнительные сервисы, которые использует БАСФОР, для обработки персональных данных:</p><table><thead><tr><th>СЕРВИС</th><th>ТИП ДАННЫХ</th><th>ПРАВИЛА ИСПОЛЬЗОВАНИЯ</th></tr></thead><tbody><tr><td>emarsys</td><td>(email, name, orders information (date, route))</td><td><a target="_blank" href="https://www.emarsys.com">https://www.emarsys.com</a></td></tr><tr><td>esputnik</td><td>(email, name, phone number)</td><td><a target="_blank" href="https://esputnik.com">https://esputnik.com</a></td></tr><tr><td>analytics</td><td>(IP addresses, email address required to log-in)</td><td><a target="_blank" href="https://google.com">https://google.com</a></td></tr><tr><td>AppsFlyer</td><td>(orders information, location)</td><td><a target="_blank" href="https://appsflyer.com/">https://appsflyer.com/</a></td></tr></tbody></table><p>Когда Вы загружаете и используете наши мобильные приложения или службы, БАСФОР автоматически получает информацию о типе используемого вами устройства, версии операционной системы, а также информацию о местоположении Вашего мобильного устройства.</p><h4 id="data_collection_goals">ЦЕЛИ СБОРА ПЕРСОНАЛЬНЫХ ДАННЫХ</h4><p>Согласием с настоящей Политикой Пользователь, а также лица, в интересах которых Пользователь соглашается с настоящей Политикой, выражают свое согласие на обработку БАСФОРОМ и (или) поставщиками услуг, оказываемых с помощью Сайта, персональных данных в следующих целях:<ul><li>идентификация Пользователя при оформлении электронного билета и его дальнейшей клиентской и технической поддержки при возникновении трудностей связанных с оказанием услуг, предоставляемых БАСФОР;</li><li>связь с Пользователем (в том числе экстренная) путём направления уведомлений, запросов и информации, касающихся использования Сайта, оказания предусмотренных Сайтом услуг, а также обработка запросов и заявок от Пользователей, отправка сообщений по электронной почте, а также посредством смс-сообщений с целью подтверждения (отмены) бронирования, уведомления об изменении в расписании рейсов, об изменении места отправления, отмене рейса, изменениях любых иных параметров рейса, а также о любых иных событиях, связанных с оказанием услуг в рамках использования Сайта;</li><li>направление Пользователю электронного билета и электронного чека, подтверждающего прохождение оплаты;</li><li>улучшение качества работы Сайта, удобства его использования, разработка новых услуг;</li><li>получение по каналам связи (в том числе в смс-сообщениях) информации об услугах, статусе их оказания, а также об акциях, скидках, новостях БАСФОР и его партнёров;</li><li>передача данных контрагентам (внутренняя и трансграничная), осуществляющим перевозку пассажиров по оформленным через БАСФОР электронным билетам, филиалам и дочерним предприятиям БАСФОР, третьим сторонам с целью отправки Пользователю информации о БАСФОР и его предприятиях, а также отправки рекламных материалов от его партнеров;</li><li>проведение статистических и иных исследований, на основе обезличенных данных.</li></ul></p><h4 id="child_personal_data_agreement">СОГЛАСИЕ НА ОБРАБОТКУ ПЕРСОНАЛЬНЫХ ДАННЫХ РЕБЕНКА</h4><p>БАСФОР понимает важность дополнительных мер предосторожности для обеспечения конфиденциальности и безопасности детей при использовании ими услуг, предоставляемых БАСФОР.</p><p>Обращаем внимание, что в случае оформлении билета на ребенка младше 18 лет, согласие на обработку его персональных данных дает его законный представитель (родитель/опекун) - если Вам меньше 18 лет, не вводите на нашем сайте свои персональные данные без одобрения родителей/опекунов и не пользуйтесь услугами нашего сайта.</p><p>БАСФОР сознательно не собирает персональные данные о детях до 18 лет. Если Вы (Пользователь) считаете, что мы непреднамеренно собрали подобную информацию, свяжитесь с нами по электронному адресу <a href="mailto:help@api.staging.busfor.com">help@api.staging.busfor.com</a>, чтобы мы получили согласие законного представителя либо удалили эти данные.</p><h4 id="methods_and_terms_of_personal_data_processing">СПОСОБЫ И СРОКИ ОБРАБОТКИ ПЕРСОНАЛЬНЫХ ДАННЫХ</h4><p>Обработка персональных данных Пользователя включает в себя любое действие (операция) или совокупность действий (операций), совершаемых с использованием средств автоматизации или без использования таких средств с персональными данными, включая сбор, запись, систематизацию, накопление, хранение, уточнение (обновление, изменение), извлечение, использование, передачу (распространение, предоставление, доступ), в том числе трансграничную передачу, обезличивание, блокирование, удаление, уничтожение персональных данных.</p><p>Согласие на обработку персональных данных действует бессрочно, с момента получения согласия (акцепта) от Пользователя с условиями настоящей Политики до момента отзыва согласия на обработку персональных данных Пользователем либо до тех пор, пока они требуются для исполнения соответствующих целей обработки (например, предоставление сервисного обслуживания, обязательств по исполнению договора перевозки).</p><h4 id="user_rights">ПРАВА ПОЛЬЗОВАТЕЛЯ</h4><p>Пользователь имеет право в любое время попросить БАСФОР не обрабатывать его персональные данные в различных целях, например, рекламных. Это можно сделать направив заявление в письменной форме (подписанное Пользователем) на юридический адрес БАСФОР почтовым отправлением (заказным письмом с уведомлением о вручении) либо его скан-копию (четкое изображение и читаемый текст) на электронный адрес БАСФОР <a href="mailto:help@api.staging.busfor.com">help@api.staging.busfor.com</a>.</p><p><span class="bold">Право на отказ от обработки данных.</span> В случае, если Пользователь принял решение отозвать свое Согласие на обработку персональных данных, то ему достаточно направить письменное заявление в адрес БАСФОР способом, описанным выше.</p><p>В случае отзыва согласия на обработку персональных данных вся полученная от Пользователя информация, в том числе логин и пароль, удаляется в течение тридцати дней с даты поступления указанного отзыва, после чего Пользователь не будет иметь доступ к Сайту с их помощью.</p><p><span class="bold">Право на отказ от рассылки.</span> Сайт БАСФОР при оформлении электронного билета (либо в личном кабинете) предоставляет Пользователю возможность согласиться, либо отказаться от получения информации о новостях и акциях БАСФОР (рекламная рассылка). Если Пользователь не предоставит свое согласие, БАСФОР не будет направлять Пользователю информацию о своих предложениях/новостях и акциях.</p><p>В случае, если Пользователь принял решение отказаться от получения рассылки, то ему достаточно кликнуть на ссылку «Отписаться от рассылки» внизу письма (такая ссылка доступна внизу каждого e-mail сообщения от БАСФОР). Также, Пользователь может направить по электронной почте <a href="mailto:help@api.staging.busfor.com">help@api.staging.busfor.com</a> сообщение с отказом от получения рассылки.</p><p>Однако, даже при отзыве согласия Пользователем либо отсутствии согласия Пользователя БАСФОР оставляет за собой право информировать Пользователя о важных административных изменениях – об изменении политики конфиденциальности или пользовательского соглашения (оферты) и др.</p><p><span class="bold">Право на просмотр и изменение данных.</span> Пользователь вправе просматривать свои данные в личном кабинете на сайте busfor.ru, и изменять их по своему желанию. Для Вашей безопасности некоторые элементы личной информации можно изменить, только обратившись в службу поддержки. БАСФОР оперативно ответит на Ваш запрос в разумные сроки. БАСФОР вправе потребовать подтверждение корректности предоставляемых обновленных данных.</p><p><span class="bold">Право на удаление (забвение) данных.</span> Данные Пользователя будут удалены нами по письменному запросу Пользователя, направленному в адрес БАСФОР в порядке, описанном выше. Если мы не сможем удовлетворить запрос Пользователя по требованиям законодательства, об этом будет сообщено дополнительно.</p><p><span class="bold">Право на перенос персональных данных.</span> Пользователь вправе потребовать (запрос в письменном виде) передать ему (Пользователю) или третьему лицу его персональные данные, и мы предоставим их Пользователю с структурированном/машинописном варианте (возможно только при наличии технической возможности и автоматизированной обработке информации).</p><p><span class="bold">Право на ограничение обработки данных.</span> По письменному запросу Пользователя (направленному в адрес БАСФОР в порядке, описанном выше) мы можем ограничить обработку его данных в случаях необходимости установления их точности, незаконного использования (но Пользователь против удаления данных), необходимость обработки данных отпала, данные обрабатываются без согласия Пользователя и право БАСФОР на их обработку устанавливается.</p><p><span class="bold">Право на доступ.</span> На основании письменного запроса Пользователя БАСФОР предоставит копию всех имеющихся персональных данных Пользователя и подтвердит законность их обработки.</p><h4 id="cookie_files">ФАЙЛЫ COOKIES</h4><p>С целью ускорения исполнения услуг, а также в иных целях, предусмотренных настоящей Политикой, будут использованы учетные строки (cookies), идентифицирующие каждого Пользователя с максимальной быстротой для повышения скорости работы и обеспечения Пользователя услугами, оценки и повышении эффективности рекламы, а также для анализа статистических данных, целях обеспечения безопасности и борьбы со спамом, которые содержатся в учетных строках (cookies). Информация, собранная с помощью cookies и других подобных технологий, не считается личной.</p><p>У Пользователя есть возможность принять или отказаться от использования файлов cookies, изменив настройки своего браузера. Однако, отказавшись от использования файлов cookies, Пользователь не сможет использовать все возможности сайта БАСФОР.</p><h4 id="external_sites_links">ССЫЛКИ НА ДРУГИЕ САЙТЫ</h4><p>БАСФОР может добавлять ссылки на другие сайты. Эти сайты могут осуществлять деятельность под руководством третьих лиц и использовать собственную Политику конфиденциальности. Поэтому БАСФОР не несет никакой ответственности или обязательства за содержание, деятельность и политику конфиденциальности каждого сайта, которые Вы посещаете. Перед использованием таких сайтов, БАСФОР рекомендует ознакомиться с политикой конфиденциальности, представленной на таком сайте.</p><p>Данная Политика конфиденциальности применяется только к информации, собранной нашим сайтом busfor.ru.</p><h4 id="third_party_information_disclosure_cases">СЛУЧАИ РАСКРЫТИЯ ИНФОРМАЦИИ ТРЕТЬИМ ЛИЦАМ</h4><p>В отношении персональных данных Пользователей сохраняется их конфиденциальность. БАСФОР вправе передать персональные данные пользователя третьим лицам в следующих случаях:<ul><li>Пользователь выразил своё согласие на такие действия;</li><li>передача необходима в рамках использования Пользователем Сайта либо для оказания предусмотренных им услуг (в т.ч. прохождение оплаты и передача данных перевозчику для исполнения договора перевозки);</li><li>в соответствии с законодательством Российской Федерации, в рамках установленной законодательством процедуры (требования Федерального закона от 09.02.2007 N16-ФЗ "О транспортной безопасности" (с изменениями и дополнениями), Федерального закона от 27.07.2006 №152-ФЗ «О персональных данных» и действующего законодательства РФ и др.);</li><li>в соответствии с требованиями судопроизводства, судебного разбирательства или по запросу государственных органов Российской Федерации или других стран, в целях национальной безопасности, исполнения закона и иных общественно важных целях;</li><li>в случае реорганизации, слияния или продажи БАСФОР;</li><li>в целях обеспечения прав и законных интересов Пользователя;</li><li>в целях обеспечения возможности защиты прав и законных интересов Общества или третьих лиц в случаях, когда Пользователь нарушает условия настоящей Политики.</li></ul></p><p>В случаях, предусмотренных Федеральным законом от 27.07.2006 №152-ФЗ «О персональных данных», обработка специальных категорий персональных данных Пользователя осуществляется только в соответствии с положениями настоящего закона.</p><p>Пользователь осведомлен, что БАСФОР может передавать его данные в любую страну мира, включая США и другие страны, с соблюдением принципов и требований к защите конфиденциальной информации в отношении любой дальнейшей передачи личных данных (как внутренней, так и трансграничной), в том числе и дальнейшего переноса обязательств.</p><h4 id="personal_data_protection">ЗАЩИТА ПЕРСОНАЛЬНЫХ ДАННЫХ</h4><p>БАСФОР несет ответственность за обработку получаемых персональных данных в соответствии с положениями законодательства в сфере обработки персональных данных и требует соблюдения предусмотренных законом требований со стороны своих контрагентов и партнеров, в процессе предоставления услуг и обработке данных.</p><p>Для защиты персональных данных Пользователей от неправомерного или случайного доступа, уничтожения, изменения, блокирования, копирования, распространения, а также иных неправомерных действий с ними третьих лиц, БАСФОР применяет необходимые и достаточные организационные и технические меры, соответствующие стандартным рынка.</p><p>БАСФОР использует технологию шифрования данных SSL (Secure Socket Layer), чтобы защитить информацию, которую Пользователь предоставляет. Эта технология защищает Ваши данные и гарантирует, что они не будут перехвачены в момент передачи. Когда Вы находитесь на защищенной странице, в окне браузера появится иконка «замок», подтверждая, что осуществляется защищенное, зашифрованное соединение с сайтом БАСФОР.</p><p>БАСФОР использует и иные средства защиты, такие как системы авторизации (например, смс-код, направляемый на мобильный телефон Пользователя, для входа в Личный кабинет). Пользователь должен сохранять конфиденциальность информации, содержащейся в Личном кабинете и не предоставлять никому, полученные коды доступа.</p><p>Мы также делаем все возможное, чтобы защитить данные Пользователей вне сети. Вся информация о Пользователях конфиденциальна в наших офисах. Только сотрудники, которым для исполнения своей работы необходимо видеть данные Пользователей, имеют к ним доступ. Сервера, на которых хранятся персональные данные Пользователей, расположены на охраняемых объектах, имеют актуальные обновления безопасности и оборудованы аппаратами/системами криптографической защиты данных.</p><p>При утрате или разглашении персональных данных Пользователя БАСФОР информирует Пользователя о данном факте. БАСФОР обязуется принять необходимые организационные и технические меры для защиты персональной информации Пользователя от неправомерного или случайного доступа, уничтожения, изменения, блокирования, копирования, распространения, а также иных неправомерных действий третьих лиц.</p><p>БАСФОР совместно с Пользователем принимает все необходимые меры по предотвращению убытков или иных отрицательных последствий, вызванных утратой или разглашением персональных данных Пользователя.</p><h4 id="user_requests_and_complaints">ЗАПРОСЫ И ЖАЛОБЫ ПОЛЬЗОВАТЕЛЯ</h4><p>Если у Вас (Пользователя) есть замечания или вопросы по настоящей Политике конфиденциальности, либо сомнения, связанные с конфиденциальностью или использованием персональных данных, пожалуйста, обратитесь в БАСФОР по электронному адресу <a href="mailto:help@api.staging.busfor.com">help@api.staging.busfor.com</a> или по адресу 117638, г.Москва, ул.Одесская, д.2, корп.А, этаж 9. В своем обращении как можно подробней опишите ситуацию (ваши опасения, сомнения) и мы сделаем все возможное, чтобы в максимально короткие сроки рассмотреть Ваше обращение и помочь Вам.</p><p>БАСФОР определило в компании ответственного (уполномоченного) по защите персональных данных. В случае появления вопросов/сомнений по Политике персональных данных, действиям БАСФОР по обработке Ваших персональных данных, а также иные вопросы/проблемы относительно личной информации, Вы можете обратиться к нашему уполномоченному по защите персональных данных:</p><table><tbody><tr><td><ul><li>Кому: Ответственному по защите персональных данных ООО «БАСФОР»</li><li>e-mail: <a href="mailto:dpofficer@busfor.com">dpofficer@busfor.com</a></li><li>117638, г.Москва, ул.Одесская, д.2, корп.А, этаж 9</li></ul></td><td><ul><li>To: Responsible for the protection of personal data of LLC «BUSFOR»</li><li>e-mail: <a href="mailto:dpofficer@busfor.com">dpofficer@busfor.com</a></li><li>117638, Moscow, ul. Odessa, d. 2, bldg.A, floor 9.</li></ul></td></tr></tbody></table><p>Если Вы (Пользователь) считаете, что мы не разобрались с Вашим вопросом, Вы можете обратиться в местный орган по надзору за соблюдением законодательства по защите персональных данных - Федеральную службы по надзору в сфере связи, информационных технологий и массовых коммуникаций, либо к нашему представителю в ЕС: Busfor.pl sp. z o.o. (Польша), 40-013, Polska, Katowice, ul. Staromiejska, 6/10D, tel.:+48 730 277 296*, e-mail: <a href="mailto:dpofficer@busfor.com">dpofficer@busfor.com</a> (в соответствии с положениями Регламента №2016/679 Европейского парламента и Совета Европейского Союза «О защите физических лиц при обработке персональных данных и о свободном обращении таких данных»).</p><p>* Стоимость звонка согласно тарифам Вашего оператора.</p><p>Чтобы узнать, как подать запрос/жалобу или уточнить сроки их рассмотрения – свяжитесь с нами по электронному адресу <a href="mailto:help@api.staging.busfor.com">help@api.staging.busfor.com</a> или по адресу 117638, г.Москва, ул.Одесская, д.2, корп.А, этаж 9.</p><h4 id="update_of_privacy_policy">ИЗМЕНЕНИЕ ПОЛИТИКИ КОНФИДЕНЦИАЛЬНОСТИ</h4><p>Настоящая Политика может быть изменена без предварительного уведомления или согласия Пользователя.</p><p>В случае внесения существенных изменений в Политику конфиденциальности на нашем сайте будет размещено соответствующее уведомление или будет осуществлена рассылка уведомлений на электронные адреса Пользователей, а также опубликована обновленная Политика. Новая редакция Политики вступает в силу с момента её размещения, если иное не предусмотрено новой редакцией Политики. Вам следует время от времени проверять текст Политики конфиденциальности с целью убедиться, что сделанные изменения являются для Вас приемлемыми.</p><p>К настоящей Политике и отношениям между Пользователями и БАСФОР, возникающим при ее использовании, подлежит применению право Российской Федерации.</p>',
  (err, element) => {}
)
